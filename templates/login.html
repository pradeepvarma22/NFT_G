<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetaConnect</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://unpkg.com/moralis/dist/moralis.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

</head>

<body>


    <nav class="navbar navbar-expand-md navbar-light bg-white">
        <div class="container-fluid">

            <a class="navbar-brand" href="#"><i><img
                        src="https://spicyip.com/wp-content/uploads/2021/04/NFT_Icon-230x230.png"
                        style="width:30px;" /></i></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span> </button>
            <div class="collapse navbar-collapse justify-content-between" id="navbarSupportedContent">
                <ul class="navbar-nav">
                    <li class="nav-item li-color">
                        <a class="nav-link" href="#">Home </i></a>
                    </li>
                </ul>
                <div>
                    <button style="color:black;border-radius: 50px" class="btn btn-warning" id="login"
                        onclick="login()"><strong style="font-weight: 550;"></strong>Login with
                        Metamask</strong></button>
                </div>
            </div>
        </div>
        </div>
        </div>
    </nav>
    <hr>

    <form method="post" action="{% url 'login' %}" id="form-id" class="mx-1 mx-md-4">
        {% csrf_token %}
        <div class="d-flex flex-row align-items-center mb-4">
            <input type="hidden" name="address" id="js_data_input">


            <div class="d-flex justify-content-center mx-4 mb-3 mb-lg-4">
                <button type="submit" class="btn btn-primary btn-lg" id="btn-submit" hidden>Submit</button>
            </div>

    </form>

    </div>
    <div class="col-md-10 col-lg-6 col-xl-7 d-flex align-items-center order-1 order-lg-2">
        <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-registration/draw1.webp" class="img-fluid"
            alt="Sample image">
    </div>
    </section>
    </div>
    </div>
    </div>
    </div>
    </div>
    </div>
    </section>



    <script>
        window.onload = function () {
            document.getElementById('submit-action').onclick = function () {
                document.getElementById('form-id').submit();
                return false;
            };
        };



        var user, wallet;
        async function login() {
            console.log("login clicked");

            if (window.ethereum) {
                const provider_t = new ethers.providers.Web3Provider(window.ethereum);
                const allWalletAccounts = await window.ethereum.request({ method: 'eth_requestAccounts' });

                //signer is json rpc signer
                const signer_t = provider_t.getSigner();

                document.getElementById('js_data_input').value = allWalletAccounts[0];
                console.log(allWalletAccounts[0]);
                document.getElementById("btn-submit").click();


            }
            else {
                console.log('not installed');
            }
        }
    </script>

</body>

</html>